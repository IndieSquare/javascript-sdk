{"version":3,"sources":["index.js"],"names":["Message","require","IndieSquare","parent_params","base","baseApi","apikey","use_server","window","location","protocol","hostname","e","port","scheme","userAgent","navigator","toLowerCase","indexOf","u","replace","c","r","Math","random","v","toString","params","channel","connect","_params","nonce","_uuid","_scheme","_getscheme","request","unsigned_hex","Object","assign","xcallback_functions","url_params","JSON","stringify","xcallback_params","key","slice","url","urlScheme","md","mobile","os","console","log","message","weblink","document","time","Date","getTime","setTimeout","response","status","error","Error","callback","self","fetch","then","_checkStatus","result","_linkageWallet","json","data","failed","catch","method","headers","RegExp","test","address","signature","verify","_pubsub","unsigned_tx","receiveChannel","xsuccess","_verifyAddress","_requestApi","source","token","pattern","description","_requestJSON","endpoint"],"mappings":"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","file":"index.js","sourcesContent":["import 'whatwg-fetch';\nimport MobileDetect from 'mobile-detect';\nvar Message = require('bitcore-message');\n\nclass IndieSquare {\n\tconstructor( parent_params ){\n\t\tthis.base = 'https://indiesquare.me';\n\t\tthis.baseApi = 'https://api.indiesquare.me';\n\t\tthis.apikey = null;\n\t\t\n\t\tif( parent_params ){\n\t\t\tif( parent_params.apikey != null ){\n\t\t\t\tthis.apikey = parent_params.apikey;\n\t\t\t}\n\t\t\tif( parent_params.use_server && parent_params.use_server !== false ){\n\t\t\t\ttry{ this.baseApi = window.location.protocol + '//' + window.location.hostname; }\n\t\t\t\tcatch(e){ this.baseApi = 'http://localhost'; }\n\t\t\t\t\n\t\t\t\tif( parent_params.port ){\n\t\t\t\t\tthis.baseApi += ':' + parent_params.port;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthis.baseApi += ':8080';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tgetBaseUrl(){\n\t\treturn this.base;\n\t}\n\t\n\tgetBaseApiUrl(){\n\t\treturn this.baseApi;\n\t}\n\t\n\tgetApiKey(){\n\t\treturn this.apikey;\n\t}\n\t\n\t_getscheme() {\n\t\tvar scheme = null;\n\t\ttry{\n\t\t    var userAgent = window.navigator.userAgent.toLowerCase();\n\t\t\tif( userAgent.indexOf('indiesquarewallet') != -1 ) scheme = 'indiesquarewallet';\n\t\t\telse if( userAgent.indexOf('msie') != -1 ) scheme = null;\n\t\t\telse if( userAgent.indexOf('crios') != -1 ) scheme = 'googlechrome';\n\t\t\telse if( userAgent.indexOf('safari') != -1 ) scheme = 'http';\n\t\t\telse if( userAgent.indexOf('opera') != -1 ) scheme = 'opera-http';\n\t\t\telse if (userAgent.indexOf('android') != -1) scheme = 'http';\n\t\t}\n\t\tcatch(e){\n\t\t\tscheme = 'http';\n\t\t}\n\t\treturn scheme;\n\t};\n\t\n\t_uuid() {\n\t\tvar u = 'xxxxxxxx-xxxx'.replace(/[xy]/g, function(c) {\n\t\tvar r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n\t\t\treturn v.toString(16);\n\t\t});\n\t\treturn u;\n\t}\n\t\n\t_linkageWallet(params, channel, connect){\n\t\tvar _params = { channel: channel, nonce: this._uuid() };\n\t\tvar _scheme = this._getscheme();\n\t    if( _scheme === 'indiesquarewallet' && params.request == 'sign' ) _params['unsigned_hex'] = params.unsigned_hex;\n\t\t\n\t\tif( params.request === 'screen_to' ){\n\t\t\tObject.assign(_params, params);\n\t\t\tdelete _params['channel'];\n\t\t\tdelete _params['request'];\n\t\t}\n\t\t\n\t\tvar xcallback_functions = ['verifyuser', 'getaddress', 'qrcode', 'signmessage'];\n\t\tvar url_params = params.request + '?params=' + JSON.stringify(_params);\n\t\tif( xcallback_functions.indexOf(params.request) >= 0 ){\n\t\t\tvar xcallback_params = '';\n\t\t\t\n\t\t\t_params['x-success'] = params['x-success'];\n\t\t\t_params['msg'] = (params['message'] != null)? params['message']: channel;\n\t\t\tfor( var key in _params ){\n\t\t\t\txcallback_params += key + '=' + _params[key] + '&';\n\t\t\t}\n\t\t\turl_params = 'x-callback-url/' + params.request + '?' + xcallback_params.slice(0, -1);\n\t\t}\n\t\tvar url = 'indiewallet://' + url_params;\n\t\t\n\t\tvar urlScheme = null;\n\t\tvar md = null;\n\t\ttry{\n\t\t\tmd = new MobileDetect(window.navigator.userAgent);\n\t\t    if (md.mobile()) {\n\t\t\t  if (md.os() === 'iOS') {\n\t\t        urlScheme = url;\n\t\t      } else {\n\t\t        urlScheme = 'intent://#Intent;scheme=indiewallet;package=inc.lireneosoft.counterparty;S.source=' + url_params + ';end';\n\t\t      }\n\t\t    }\n\t    }\n\t    catch(e){\n\t\t    console.log(e.message);\n\t    }\n\t    \n\t    if( _scheme === 'indiesquarewallet' ){\n\t\t\tweblink = function(){\n\t\t\t\tweblink = null;\n\t\t\t\treturn url;\n\t\t\t};\n\t\t}\n\t    else {\n\t\t\tif( md && md.mobile() ){\n\t\t\t\tdocument.location = urlScheme;\n\t\t\t}\n\t\t\tvar time = (new Date()).getTime();\n\t        setTimeout(function(){\n\t            if( ((new Date()).getTime() - time) < 400 ){\n\t                connect(url, urlScheme, null);\n\t            }\n\t        }, 300);\n\t    }\n    }\n    \n    _checkStatus(response) {\n\t\tif( response.status >= 200 && response.status < 300 ){\n\t\t\treturn response;\n\t\t}\n\t\telse {\n\t\t\tvar error = new Error();\n\t\t\terror.response = response;\n\t\t\tthrow error;\n\t\t}\n\t}\n    \n    _pubsub(channel, params, connect, callback){\n\t    var self = this;\n\t    fetch(this.base + '/pubsub/topic', {\n\t\t\t'method': 'POST',\n\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t'body': 'channel=' + channel\n\t\t})\n\t\t.then(this._checkStatus)\n\t\t.then(function(result) {\n\t\t\tself._linkageWallet(params, channel, connect);\n\t\t\t\n\t\t\tfetch(self.base + '/pubsub/subscribe', {\n\t\t\t\t'method': 'POST',\n\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t'body': 'channel=' + channel + '&type=1',\n\t\t\t\t'timeout': 1800\n\t\t\t})\n\t\t\t.then(self._checkStatus)\n\t\t\t.then(function(response) {\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(function(data) {\n\t\t\t\tif( data.failed ){\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t\treturn;\n\t\t\t    }\n\t\t\t    callback(data, null);\n\t\t\t})\n\t\t\t.catch(function(error) {\n\t\t\t\tcallback(null, error);\n\t\t\t});\n\t\t})\n\t\t.catch(function(error) {\n\t\t\tconnect(null, null, error);\n\t\t});\n\t}\n\t\n\t_requestJSON( url, callback ){\n\t\tfetch(url)\n\t\t.then(function(response) {\n\t\t\treturn response.json()\n\t\t}).then(function(json) {\n\t\t\tcallback(json, null);\n\t\t}).catch(function(error) {\n\t\t\tcallback(null, error);\n\t\t});\n\t}\n\t\n\t_requestApi( method, url, params, callback ){\n\t\tvar headers = { 'Content-Type': 'application/json; charset=utf-8' }\n\t\tif( this.apikey != null ) headers['X-Api-Key'] = this.apikey;\n\t\tif( !new RegExp('^(https?:\\\\/\\\\/)').test(url) ) url = 'https://' + url;\n\t\t\n\t\tfetch(url, {\n\t\t\t'method': method,\n\t\t\t'headers': headers,\n\t\t\t'body': (method === 'GET')? null: JSON.stringify(params)\n\t\t})\n\t\t.then(function(response) {\n\t\t\tif( response.status >= 200 && response.status < 300 ){\n\t\t\t\treturn response.json();\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn response.json().then(function(data){\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\terror.data = data;\n\t\t\t\t\tthrow error;\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t\t.then(function(data) {\n\t\t\tcallback(data, null);\n\t\t})\n\t\t.catch(function(error) {\n\t\t\tcallback(null, error.data);\n\t\t});\n\t}\n\t\n\t_verifyAddress( params ){\n\t\tif( params.address != null && params.message != null && params.signature != null ){\n\t\t\treturn Message(params.message).verify(params.address, params.signature);\n\t\t}\n\t\treturn false;\n\t}\n\t\n\tsignTransaction(params, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t  \n\t\tthis._pubsub(channel, {'request': 'sign', 'unsigned_hex': params.unsigned_tx}, connect, function( result, error ){\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(result.data, null);\n\t\t});\n\t\t\n\t\tvar self = this;\n\t\t\n\t\tif( this._getscheme() !== 'indiesquarewallet' ){\n\t\t\tvar receiveChannel = channel + 'receive';\n\t\t\tfetch(this.base + '/pubsub/topic', {\n\t\t\t\t'method': 'POST',\n\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t'body': 'channel=' + receiveChannel\n\t\t\t})\n\t\t\t.then(this._checkStatus)\n\t\t\t.then(function(data) {\n\t\t\t\tfetch(self.base + '/pubsub/publish', {\n\t\t\t\t\t'method': 'POST',\n\t\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t\t'body': 'channel=' + receiveChannel + '&data=' + JSON.stringify({ 'unsigned_hex': params.unsigned_tx })\n\t\t\t\t})\n\t\t\t\t.then(self._checkStatus)\n\t\t\t\t.then(function(response) {\n\t\t\t\t\treturn response.json();\n\t\t\t\t})\n\t\t\t\t.then(function(data) {\n\t\t\t\t\tif( data.failed ){\n\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\treturn;\n\t\t\t\t    }\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tcallback(null, error);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(function(error) {\n\t\t\t\tconnect(null, null, error);\n\t\t\t});\n\t\t}\n\t}\n\t\n\tgetAddress(xsuccess, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t\tvar self = this;\n\t\tthis._pubsub(channel, {'request': 'getaddress', 'x-success': xsuccess}, connect, function( result, error ){\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar verify = self._verifyAddress({ 'address': result.data.address, 'message': channel, 'signature': result.data.signature});\n\t\t\tif( !verify ){\n\t\t\t\tcallback(null, {'message': 'Invalid Address'});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback({'address': result.data.address, 'veryfy': verify}, null);\n\t\t});\n\t}\n\t\n\tgetQRcode(xsuccess, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t\tvar self = this;\n\t\tthis._pubsub(channel, { 'request': 'qrcode', 'x-success': xsuccess }, connect, function (result, error) {\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar verify = self._verifyAddress({ 'address': result.data.address, 'message': channel, 'signature': result.data.signature});\n\t\t\tif( !verify ){\n\t\t\t\tcallback(null, {'message': 'Invalid Data'});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback({'data': result.data.data, 'verify': verify}, null);\n\t\t});\n\t}\n\t\n\tsignMessage(params, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t\tvar self = this;\n\t\tthis._pubsub(channel, {'request': 'signmessage', 'x-success': params.xsuccess, 'message': params.message }, connect, function( result, error ){\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar verify = self._verifyAddress({ 'address': result.data.address, 'message': params.message, 'signature': result.data.signature});\n\t\t\tif( !verify ){\n\t\t\t\tcallback(null, {'message': 'Invalid Signature'});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback({'message': result.data.message, 'signature': result.data.signature, 'verify': verify}, null);\n\t\t});\n\t}\n\t\n\ttransition(params, callback) {\n\t\tparams.request = 'screen_to';\n\t\tthis._linkageWallet(params, null, callback);\n\t}\n\t\n\tcreateSend(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/send', params, callback );\n\t}\n\t\n\tcreateIssuance(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/issuance', params, callback );\n\t}\n\t\n\tcreateOrder(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/order', params, callback );\n\t}\n\t\n\tcreateCancel(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/cancel', params, callback );\n\t}\n\t\n\tbroadcast(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/broadcast', params, callback );\n\t}\n\t\n\tunpackTransaction(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/unpack', params, callback );\n\t}\n\t\n\tgetBalances(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/addresses/' + params.source + '/balances', params, callback );\n\t}\n\t\n\tgetHistory(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/addresses/' + params.source + '/history', params, callback );\n\t}\n\t\n\tgetTokenInfo(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token, params, callback );\n\t}\n\t\n\tgetTokenHolders(params, callback) {\n\t  this._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token + '/holders', params, callback );\n\t}\n\t\n\tgetTokenHistory(params, callback) {\n\t  this._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token + '/history', params, callback );\n\t}\n\t\n\tgetTokenDescription(params, callback) {\n\t\tvar pattern = new RegExp('^(https?:\\\\/\\\\/)?((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*(\\\\?[;&a-z\\\\d%_.~+=-]*)?(\\\\#[-a-z\\\\d_]*)?$','i');\n\t\tif( pattern.test(params.description) ){\n\t\t\tthis._requestJSON( params.description, callback);\n\t\t}\n\t\telse{\n\t\t\tcallback({'description': params.description, 'website': ''}, null);\n\t\t}\n\t}\n\t\n\tcallApi(method, endpoint, params, callback) {\n\t\tthis._requestApi( method, this.baseApi + endpoint.url, params, callback );\n\t}\n}\nexport default IndieSquare;"]}