{"version":3,"sources":["index.js"],"names":["IndieSquare","parent_params","base","baseApi","apikey","window","weblink","e","use_server","location","protocol","hostname","port","scheme","userAgent","navigator","toLowerCase","indexOf","u","replace","c","r","Math","random","v","toString","params","channel","connect","_params","nonce","_uuid","_scheme","_getscheme","request","unsigned_hex","Object","assign","url_params","JSON","stringify","xcallback_params","key","slice","url","urlScheme","md","mobile","os","document","time","Date","getTime","setTimeout","response","status","error","Error","callback","self","fetch","then","_checkStatus","result","_linkageWallet","json","data","failed","catch","method","headers","RegExp","test","_pubsub","unsigned_tx","receiveChannel","xsuccess","_requestApi","source","token","pattern","description","_requestJSON","endpoint"],"mappings":"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","file":"index.js","sourcesContent":["import 'whatwg-fetch';\nimport MobileDetect from 'mobile-detect';\n\nclass IndieSquare {\n\tconstructor( parent_params ){\n\t\tthis.base = 'https://indiesquare.me';\n\t\tthis.baseApi = 'https://api.indiesquare.me';\n\t\tthis.apikey = null;\n\t\t\n\t\ttry{ window.weblink = null; } catch(e){}\n\t\t\n\t\tif( parent_params ){\n\t\t\tif( parent_params.apikey != null ){\n\t\t\t\tthis.apikey = parent_params.apikey;\n\t\t\t}\n\t\t\tif( parent_params.use_server && parent_params.use_server !== false ){\n\t\t\t\ttry{\n\t\t\t\t\tthis.baseApi = window.location.protocol + '//' + window.location.hostname;\n\t\t\t\t}\n\t\t\t\tcatch(e){ this.baseApi = 'http://localhost'; }\n\t\t\t\t\n\t\t\t\tif( parent_params.port ){\n\t\t\t\t\tthis.baseApi += ':' + parent_params.port;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthis.baseApi += ':8080';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tgetBaseUrl(){\n\t\treturn this.base;\n\t}\n\t\n\tgetBaseApiUrl(){\n\t\treturn this.baseApi;\n\t}\n\t\n\tgetApiKey(){\n\t\treturn this.apikey;\n\t}\n\t\n\t_getscheme() {\n\t\tvar scheme = null;\n\t\ttry{\n\t\t    var userAgent = window.navigator.userAgent.toLowerCase();\n\t\t\tif( userAgent.indexOf('indiesquarewallet') != -1 ) scheme = 'indiesquarewallet';\n\t\t\telse if( userAgent.indexOf('msie') != -1 ) scheme = null;\n\t\t\telse if( userAgent.indexOf('crios') != -1 ) scheme = 'googlechrome';\n\t\t\telse if( userAgent.indexOf('safari') != -1 ) scheme = 'http';\n\t\t\telse if( userAgent.indexOf('opera') != -1 ) scheme = 'opera-http';\n\t\t\telse if (userAgent.indexOf('android') != -1) scheme = 'http';\n\t\t}\n\t\tcatch(e){\n\t\t\tscheme = 'http';\n\t\t}\n\t\treturn scheme;\n\t};\n\t\n\t_uuid() {\n\t\tvar u = 'xxxxxxxx-xxxx'.replace(/[xy]/g, function(c) {\n\t\tvar r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n\t\t\treturn v.toString(16);\n\t\t});\n\t\treturn u;\n\t}\n\t\n\t_linkageWallet(params, channel, connect){\n\t\tvar _params = { channel: channel, nonce: this._uuid() };\n\t\tvar _scheme = this._getscheme();\n\t    if( _scheme === 'indiesquarewallet' && params.request == 'sign' ) _params['unsigned_hex'] = params.unsigned_hex;\n\t\t\n\t\tif( params.request === 'screen_to' ){\n\t\t\tObject.assign(_params, params);\n\t\t\tdelete _params['channel'];\n\t\t\tdelete _params['request'];\n\t\t}\n\t\tvar url_params = params.request + '?params=' + JSON.stringify(_params);\n\t\tif( params.request === 'verifyuser' || params.request === 'getaddress' ){\n\t\t\tvar xcallback_params = '';\n\t\t\t\n\t\t\t_params['x-success'] = params['x-success'];\n\t\t\t_params['msg'] = channel;\n\t\t\tfor( var key in _params ){\n\t\t\t\txcallback_params += key + '=' + _params[key] + '&';\n\t\t\t}\n\t\t\turl_params = 'x-callback-url/' + params.request + '?' + xcallback_params.slice(0, -1);\n\t\t}\n\t\tvar url = 'indiewallet://' + url_params;\n\t\t\n\t\tvar urlScheme = null;\n\t\tvar md = null;\n\t\ttry{\n\t\t    md = new MobileDetect(window.navigator.userAgent);\n\t\t    if (md.mobile()) {\n\t\t      if (md.os() === 'iOS') {\n\t\t        urlScheme = url;\n\t\t      } else {\n\t\t        urlScheme = 'intent://#Intent;scheme=indiewallet;package=inc.lireneosoft.counterparty;S.source=' + url_params + ';end';\n\t\t      }\n\t\t    }\n\t    }\n\t    catch(e){}\n\t    \n\t    if( _scheme === 'indiesquarewallet' ){\n\t\t\tweblink = function(){\n\t\t\t\tweblink = null;\n\t\t\t\treturn url;\n\t\t\t};\n\t\t}\n\t    else {\n\t\t\tif( md && md.mobile() ) document.location = urlScheme;\n\t\t\tvar time = (new Date()).getTime();\n\t        setTimeout(function(){\n\t            if( ((new Date()).getTime() - time) < 400 ){\n\t                connect(url, urlScheme, null);\n\t            }\n\t        }, 300);\n\t    }\n    }\n    \n    _checkStatus(response) {\n\t\tif( response.status >= 200 && response.status < 300 ){\n\t\t\treturn response;\n\t\t}\n\t\telse {\n\t\t\tvar error = new Error();\n\t\t\terror.response = response;\n\t\t\tthrow error;\n\t\t}\n\t}\n    \n    _pubsub(channel, params, connect, callback){\n\t    var self = this;\n\t    fetch(this.base + '/pubsub/topic', {\n\t\t\t'method': 'POST',\n\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t'body': 'channel=' + channel\n\t\t})\n\t\t.then(this._checkStatus)\n\t\t.then(function(result) {\n\t\t\tself._linkageWallet(params, channel, connect);\n\t\t\t\n\t\t\tfetch(self.base + '/pubsub/subscribe', {\n\t\t\t\t'method': 'POST',\n\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t'body': 'channel=' + channel + '&type=1',\n\t\t\t\t'timeout': 1800\n\t\t\t})\n\t\t\t.then(self._checkStatus)\n\t\t\t.then(function(response) {\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(function(data) {\n\t\t\t\tif( data.failed ){\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t\treturn;\n\t\t\t    }\n\t\t\t    callback(data, null);\n\t\t\t})\n\t\t\t.catch(function(error) {\n\t\t\t\tcallback(null, error);\n\t\t\t});\n\t\t})\n\t\t.catch(function(error) {\n\t\t\tconnect(null, null, error);\n\t\t});\n\t}\n\t\n\t_requestJSON( url, callback ){\n\t\tfetch(url)\n\t\t.then(function(response) {\n\t\t\treturn response.json()\n\t\t}).then(function(json) {\n\t\t\tcallback(json, null);\n\t\t}).catch(function(error) {\n\t\t\tcallback(null, error);\n\t\t});\n\t}\n\t\n\t_requestApi( method, url, params, callback ){\n\t\tvar headers = { 'Content-Type': 'application/json; charset=utf-8' }\n\t\tif( this.apikey != null ) headers['X-Api-Key'] = this.apikey;\n\t\tif( !new RegExp('^(https?:\\\\/\\\\/)').test(url) ) url = 'https://' + url;\n\t\t\n\t\tfetch(url, {\n\t\t\t'method': method,\n\t\t\t'headers': headers,\n\t\t\t'body': (method === 'GET')? null: JSON.stringify(params)\n\t\t})\n\t\t.then(function(response) {\n\t\t\tif( response.status >= 200 && response.status < 300 ){\n\t\t\t\treturn response.json();\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn response.json().then(function(data){\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\terror.data = data;\n\t\t\t\t\tthrow error;\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t\t.then(function(data) {\n\t\t\tcallback(data, null);\n\t\t})\n\t\t.catch(function(error) {\n\t\t\tcallback(null, error.data);\n\t\t});\n\t}\n\t\n\tsignTransaction(params, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t  \n\t\tthis._pubsub(channel, {'request': 'sign', 'unsigned_hex': params.unsigned_tx}, connect, function( result, error ){\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(result.data, null);\n\t\t});\n\t\t\n\t\tvar self = this;\n\t\t\n\t\tif( this._getscheme() !== 'indiesquarewallet' ){\n\t\t\tvar receiveChannel = channel + 'receive';\n\t\t\tfetch(this.base + '/pubsub/topic', {\n\t\t\t\t'method': 'POST',\n\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t'body': 'channel=' + receiveChannel\n\t\t\t})\n\t\t\t.then(this._checkStatus)\n\t\t\t.then(function(data) {\n\t\t\t\tfetch(self.base + '/pubsub/publish', {\n\t\t\t\t\t'method': 'POST',\n\t\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t\t'body': 'channel=' + receiveChannel + '&data=' + JSON.stringify({ 'unsigned_hex': params.unsigned_tx })\n\t\t\t\t})\n\t\t\t\t.then(self._checkStatus)\n\t\t\t\t.then(function(response) {\n\t\t\t\t\treturn response.json();\n\t\t\t\t})\n\t\t\t\t.then(function(data) {\n\t\t\t\t\tif( data.failed ){\n\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\treturn;\n\t\t\t\t    }\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tcallback(null, error);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(function(error) {\n\t\t\t\tconnect(null, null, error);\n\t\t\t});\n\t\t}\n\t}\n\t\n\tgetAddress(xsuccess, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t\tthis._pubsub(channel, {'request': 'getaddress', 'x-success': xsuccess}, connect, function( result, error ){\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(result.data, null);\n\t\t});\n\t}\n\t\n\ttransition(params, callback) {\n\t\tparams.request = 'screen_to';\n\t\tthis._linkageWallet(params, null, callback);\n\t}\n\t\n\tcreateSend(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/send', params, callback );\n\t}\n\t\n\tcreateIssuance(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/issuance', params, callback );\n\t}\n\t\n\tcreateOrder(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/order', params, callback );\n\t}\n\t\n\tcreateCancel(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/cancel', params, callback );\n\t}\n\t\n\tbroadcast(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/broadcast', params, callback );\n\t}\n\t\n\tunpackTransaction(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/unpack', params, callback );\n\t}\n\t\n\tgetBalances(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/addresses/' + params.source + '/balances', params, callback );\n\t}\n\t\n\tgetHistory(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/addresses/' + params.source + '/history', params, callback );\n\t}\n\t\n\tgetTokenInfo(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token, params, callback );\n\t}\n\t\n\tgetTokenHolders(params, callback) {\n\t  this._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token + '/holders', params, callback );\n\t}\n\t\n\tgetTokenHistory(params, callback) {\n\t  this._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token + '/history', params, callback );\n\t}\n\t\n\tgetTokenDescription(params, callback) {\n\t\tvar pattern = new RegExp('^(https?:\\\\/\\\\/)?((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*(\\\\?[;&a-z\\\\d%_.~+=-]*)?(\\\\#[-a-z\\\\d_]*)?$','i');\n\t\tif( pattern.test(params.description) ){\n\t\t\tthis._requestJSON( params.description, callback);\n\t\t}\n\t\telse{\n\t\t\tcallback({'description': params.description, 'website': ''}, null);\n\t\t}\n\t}\n\t\n\tcallApi(method, endpoint, params, callback) {\n\t\tthis._requestApi( method, this.baseApi + endpoint.url, params, callback );\n\t}\n}\nexport default IndieSquare;"]}