{"version":3,"sources":["index.js"],"names":["IndieSquare","parent_params","base","baseApi","apikey","use_server","window","location","protocol","hostname","e","port","scheme","userAgent","navigator","toLowerCase","indexOf","u","replace","c","r","Math","random","v","toString","params","channel","connect","_params","nonce","_uuid","_scheme","_getscheme","request","unsigned_hex","Object","assign","url_params","JSON","stringify","xcallback_params","key","slice","url","urlScheme","md","mobile","os","weblink","document","time","Date","getTime","setTimeout","response","status","error","Error","callback","self","fetch","then","_checkStatus","result","_linkageWallet","json","data","failed","catch","method","headers","RegExp","test","_pubsub","unsigned_tx","receiveChannel","xsuccess","_requestApi","source","token","pattern","description","_requestJSON","endpoint"],"mappings":"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","file":"index.js","sourcesContent":["import '../node_modules/whatwg-fetch';\nimport MobileDetect from '../node_modules/mobile-detect';\n\nclass IndieSquare {\n\tconstructor( parent_params ){\n\t\tthis.base = 'https://indiesquare.me';\n\t\tthis.baseApi = 'https://api.indiesquare.me';\n\t\tthis.apikey = null;\n\t\t\n\t\tif( parent_params ){\n\t\t\tif( parent_params.apikey != null ){\n\t\t\t\tthis.apikey = parent_params.apikey;\n\t\t\t}\n\t\t\tif( parent_params.use_server && parent_params.use_server !== false ){\n\t\t\t\ttry{ this.baseApi = window.location.protocol + '//' + window.location.hostname; }\n\t\t\t\tcatch(e){ this.baseApi = 'http://localhost'; }\n\t\t\t\t\n\t\t\t\tif( parent_params.port ){\n\t\t\t\t\tthis.baseApi += ':' + parent_params.port;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthis.baseApi += ':8080';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\tgetBaseUrl(){\n\t\treturn this.base;\n\t}\n\t\n\tgetBaseApiUrl(){\n\t\treturn this.baseApi;\n\t}\n\t\n\tgetApiKey(){\n\t\treturn this.apikey;\n\t}\n\t\n\t_getscheme() {\n\t\tvar scheme = null;\n\t\ttry{\n\t\t    var userAgent = window.navigator.userAgent.toLowerCase();\n\t\t\tif( userAgent.indexOf('indiesquarewallet') != -1 ) scheme = 'indiesquarewallet';\n\t\t\telse if( userAgent.indexOf('msie') != -1 ) scheme = null;\n\t\t\telse if( userAgent.indexOf('crios') != -1 ) scheme = 'googlechrome';\n\t\t\telse if( userAgent.indexOf('safari') != -1 ) scheme = 'http';\n\t\t\telse if( userAgent.indexOf('opera') != -1 ) scheme = 'opera-http';\n\t\t\telse if (userAgent.indexOf('android') != -1) scheme = 'http';\n\t\t}\n\t\tcatch(e){\n\t\t\tscheme = 'http';\n\t\t}\n\t\treturn scheme;\n\t};\n\t\n\t_uuid() {\n\t\tvar u = 'xxxxxxxx-xxxx'.replace(/[xy]/g, function(c) {\n\t\tvar r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n\t\t\treturn v.toString(16);\n\t\t});\n\t\treturn u;\n\t}\n\t\n\t_linkageWallet(params, channel, connect){\n\t\tvar _params = { channel: channel, nonce: this._uuid() };\n\t\tvar _scheme = this._getscheme();\n\t    if( _scheme === 'indiesquarewallet' && params.request == 'sign' ) _params['unsigned_hex'] = params.unsigned_hex;\n\t\t\n\t\tif( params.request === 'screen_to' ){\n\t\t\tObject.assign(_params, params);\n\t\t\tdelete _params['channel'];\n\t\t\tdelete _params['request'];\n\t\t}\n\t\tvar url_params = params.request + '?params=' + JSON.stringify(_params);\n\t\tif( params.request === 'verifyuser' || params.request === 'getaddress' ){\n\t\t\tvar xcallback_params = '';\n\t\t\t\n\t\t\t_params['x-success'] = params['x-success'];\n\t\t\t_params['msg'] = channel;\n\t\t\tfor( var key in _params ){\n\t\t\t\txcallback_params += key + '=' + _params[key] + '&';\n\t\t\t}\n\t\t\turl_params = 'x-callback-url/' + params.request + '?' + xcallback_params.slice(0, -1);\n\t\t}\n\t\tvar url = 'indiewallet://' + url_params;\n\t\t\n\t\tvar urlScheme = null;\n\t\tvar md = null;\n\t\ttry{\n\t\t    md = new MobileDetect(window.navigator.userAgent);\n\t\t    if (md.mobile()) {\n\t\t      if (md.os() === 'iOS') {\n\t\t        urlScheme = url;\n\t\t      } else {\n\t\t        urlScheme = 'intent://#Intent;scheme=indiewallet;package=inc.lireneosoft.counterparty;S.source=' + url_params + ';end';\n\t\t      }\n\t\t    }\n\t    }\n\t    catch(e){}\n\t    \n\t    if( _scheme === 'indiesquarewallet' ){\n\t\t\tweblink = function(){\n\t\t\t\tweblink = null;\n\t\t\t\treturn url;\n\t\t\t};\n\t\t}\n\t    else {\n\t\t\tif( md && md.mobile() ) document.location = url;\n\t\t\tvar time = (new Date()).getTime();\n\t        setTimeout(function(){\n\t            if( ((new Date()).getTime() - time) < 400 ){\n\t                connect(url, urlScheme, null);\n\t            }\n\t        }, 300);\n\t    }\n    }\n    \n    _checkStatus(response) {\n\t\tif( response.status >= 200 && response.status < 300 ){\n\t\t\treturn response;\n\t\t}\n\t\telse {\n\t\t\tvar error = new Error();\n\t\t\terror.response = response;\n\t\t\tthrow error;\n\t\t}\n\t}\n    \n    _pubsub(channel, params, connect, callback){\n\t    var self = this;\n\t    fetch(this.base + '/pubsub/topic', {\n\t\t\t'method': 'POST',\n\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t'body': 'channel=' + channel\n\t\t})\n\t\t.then(this._checkStatus)\n\t\t.then(function(result) {\n\t\t\tself._linkageWallet(params, channel, connect);\n\t\t\t\n\t\t\tfetch(self.base + '/pubsub/subscribe', {\n\t\t\t\t'method': 'POST',\n\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t'body': 'channel=' + channel + '&type=1',\n\t\t\t\t'timeout': 1800\n\t\t\t})\n\t\t\t.then(self._checkStatus)\n\t\t\t.then(function(response) {\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(function(data) {\n\t\t\t\tif( data.failed ){\n\t\t\t\t\tcallback(null, data);\n\t\t\t\t\treturn;\n\t\t\t    }\n\t\t\t    callback(data, null);\n\t\t\t})\n\t\t\t.catch(function(error) {\n\t\t\t\tcallback(null, error);\n\t\t\t});\n\t\t})\n\t\t.catch(function(error) {\n\t\t\tconnect(null, null, error);\n\t\t});\n\t}\n\t\n\t_requestJSON( url, callback ){\n\t\tfetch(url)\n\t\t.then(function(response) {\n\t\t\treturn response.json()\n\t\t}).then(function(json) {\n\t\t\tcallback(json, null);\n\t\t}).catch(function(error) {\n\t\t\tcallback(null, error);\n\t\t});\n\t}\n\t\n\t_requestApi( method, url, params, callback ){\n\t\tvar headers = { 'Content-Type': 'application/json; charset=utf-8' }\n\t\tif( this.apikey != null ) headers['X-Api-Key'] = this.apikey;\n\t\tif( !new RegExp('^(https?:\\\\/\\\\/)').test(url) ) url = 'https://' + url;\n\t\t\n\t\tfetch(url, {\n\t\t\t'method': method,\n\t\t\t'headers': headers,\n\t\t\t'body': (method === 'GET')? null: JSON.stringify(params)\n\t\t})\n\t\t.then(function(response) {\n\t\t\tif( response.status >= 200 && response.status < 300 ){\n\t\t\t\treturn response.json();\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn response.json().then(function(data){\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\terror.data = data;\n\t\t\t\t\tthrow error;\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t\t.then(function(data) {\n\t\t\tcallback(data, null);\n\t\t})\n\t\t.catch(function(error) {\n\t\t\tcallback(null, error.data);\n\t\t});\n\t}\n\t\n\tsignTransaction(params, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t  \n\t\tthis._pubsub(channel, {'request': 'sign', 'unsigned_hex': params.unsigned_tx}, connect, function( result, error ){\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(result.data, null);\n\t\t});\n\t\t\n\t\tvar self = this;\n\t\t\n\t\tif( this._getscheme() !== 'indiesquarewallet' ){\n\t\t\tvar receiveChannel = channel + 'receive';\n\t\t\tfetch(this.base + '/pubsub/topic', {\n\t\t\t\t'method': 'POST',\n\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t'body': 'channel=' + receiveChannel\n\t\t\t})\n\t\t\t.then(this._checkStatus)\n\t\t\t.then(function(data) {\n\t\t\t\tfetch(self.base + '/pubsub/publish', {\n\t\t\t\t\t'method': 'POST',\n\t\t\t\t\t'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t\t'body': 'channel=' + receiveChannel + '&data=' + JSON.stringify({ 'unsigned_hex': params.unsigned_tx })\n\t\t\t\t})\n\t\t\t\t.then(self._checkStatus)\n\t\t\t\t.then(function(response) {\n\t\t\t\t\treturn response.json();\n\t\t\t\t})\n\t\t\t\t.then(function(data) {\n\t\t\t\t\tif( data.failed ){\n\t\t\t\t\t\tcallback(null, data);\n\t\t\t\t\t\treturn;\n\t\t\t\t    }\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tcallback(null, error);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(function(error) {\n\t\t\t\tconnect(null, null, error);\n\t\t\t});\n\t\t}\n\t}\n\t\n\tgetAddress(xsuccess, connect, callback) {\n\t\tvar channel = 'indie-' + this._uuid();\n\t\tthis._pubsub(channel, {'request': 'getaddress', 'x-success': xsuccess}, connect, function( result, error ){\n\t\t\tif( error ){\n\t\t\t\tcallback(null, error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(result.data, null);\n\t\t});\n\t}\n\t\n\ttransition(params, callback) {\n\t\tparams.request = 'screen_to';\n\t\tthis._linkageWallet(params, null, callback);\n\t}\n\t\n\tcreateSend(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/send', params, callback );\n\t}\n\t\n\tcreateIssuance(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/issuance', params, callback );\n\t}\n\t\n\tcreateOrder(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/order', params, callback );\n\t}\n\t\n\tcreateCancel(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/cancel', params, callback );\n\t}\n\t\n\tbroadcast(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/broadcast', params, callback );\n\t}\n\t\n\tunpackTransaction(params, callback) {\n\t\tthis._requestApi( 'POST', this.baseApi + '/v2/transactions/unpack', params, callback );\n\t}\n\t\n\tgetBalances(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/addresses/' + params.source + '/balances', params, callback );\n\t}\n\t\n\tgetHistory(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/addresses/' + params.source + '/history', params, callback );\n\t}\n\t\n\tgetTokenInfo(params, callback) {\n\t\tthis._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token, params, callback );\n\t}\n\t\n\tgetTokenHolders(params, callback) {\n\t  this._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token + '/holders', params, callback );\n\t}\n\t\n\tgetTokenHistory(params, callback) {\n\t  this._requestApi( 'GET', this.baseApi + '/v2/tokens/' + params.token + '/history', params, callback );\n\t}\n\t\n\tgetTokenDescription(params, callback) {\n\t\tvar pattern = new RegExp('^(https?:\\\\/\\\\/)?((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*(\\\\?[;&a-z\\\\d%_.~+=-]*)?(\\\\#[-a-z\\\\d_]*)?$','i');\n\t\tif( pattern.test(params.description) ){\n\t\t\tthis._requestJSON( params.description, callback);\n\t\t}\n\t\telse{\n\t\t\tcallback({'description': params.description, 'website': ''}, null);\n\t\t}\n\t}\n\t\n\tcallApi(method, endpoint, params, callback) {\n\t\tthis._requestApi( method, this.baseApi + endpoint.url, params, callback );\n\t}\n}\nexport default IndieSquare;"]}